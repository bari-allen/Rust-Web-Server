<!DOCTYPE html>
    <html lang="el">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" contents="width=device-width, initial-scale=1.0">
            <meta name="author" content="Karl Haidinyak">
            <title>My Photographs</title>
            <style>
                .image-container {
                    display: inline-block;
                    border: 1px solid rgb(136, 128, 128);
                    width: auto;
                    height: 350px;
                    margin-top: 5px;
                    margin-left: 2px;
                    margin-right: 2px;
                    margin-bottom: 5px;
                }
                .image-container:hover {
                    border: 1px solid rgb(0, 0, 0);
                    height: 354px;
                    margin-top: 3px;
                    margin-left: 0px;
                    margin-right: 0px;
                    margin-bottom: 3px;
                    width: auto;
                }
                .image-container img{
                    height: 100%;
                    width: auto;
                }
                #gallery{
                    display: flex;
                    justify-content: space-evenly;
                    flex-wrap: wrap;
                    flex-direction: row;
                    margin: 100px;
                    position: relative;
                }
                html, body{
                    height: auto;
                    overflow-y: auto;
                    background: #d2d8d9
                }
                #page-title{
                    text-align: center;
                    font-family: 'Times New Roman', Times;
                    font-size: 45px;
                    color: hsl(192, 13%, 16%);
                }
                .search-container{
                    display: flex;
                    justify-content: center;
                    margin: auto;
                    width: 100%;
                }

                .search-bar{
                    width: 300px;
                    border-radius: 5px;
                    outline: none;
                    font-size: 16px;
                    text-align: center;
                }
                .search-bar:focus{
                    border-color:hsl(197, 3%, 49%);
                }
                .suggestions-list{
                    max-height: 200px;
                    overflow-y: auto;
                    border-radius: 5px;
                    border-top-left-radius: 0px;
                    border-top-right-radius: 0px;
                    margin: 0;
                    padding: 0;
                    background-color: #fff;
                    list-style: none;
                    display: none; /* Initially hidden */
                    z-index: 1000;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    width: 303px;
                }
                .suggestions-list li{
                    cursor: pointer;
                    padding: 10px;
                    text-align: center;
                    font-size: 16px;
                }

            </style>
            <script src="http://127.0.0.1:8080/script/trie-script.js"></script>
            <script>
                let trie = new Trie();
                async function getPhotos() {
                    const container = document.getElementById('image-container');

                    try {
                        const response = await fetch('http://127.0.0.1:8080/get_images');
                        if (!response.ok) {
                            error_text = document.createElement('p');
                            const status = response.status;
                            error_text.textContent = "HTTP ERROR: " + status;
                            container.appendChild(error_text);
                        } else {
                            const photo_paths = await response.json();
                            displayPhotos(photo_paths);
                        }
                    } catch (error) {
                        error_text = document.createElement('p');
                        error_text.textContent = "Could Not Contact Server!";
                        container.appendChild(error_text);
                    }
                }

                function displayPhotos(photo_paths) {
                    const container = document.getElementById('gallery');
                    container.innerHTML = '';

                    photo_paths.forEach(photo => {
                        photo = photo.slice(0, -4);
                        trie.insert(photo);
                        const photo_path = "http://127.0.0.1:8080/compressed/" + photo + ".jpg";
                        const full_photo_path = "http://127.0.0.1:8080/images/" + photo + ".png";

                        const div = document.createElement('div');
                        div.className = 'image-container';

                        const anchor = document.createElement('a');
                        anchor.target = '_self';
                        anchor.href = full_photo_path;

                        const img = document.createElement('img');
                        img.src = photo_path;

                        anchor.appendChild(img);
                        div.appendChild(anchor);
                        container.appendChild(div);
                    })
                }

                function showSuggestions() {
                    const input = document.getElementsByClassName('search-bar')[0];
                    const suggestionsList = document.getElementsByClassName('suggestions-list')[0];
                    const filter = input.value;

                    suggestionsList.innerHTML = '';

                    if (filter) {
                        const suggestions = trie.suggest(filter);
                        suggestions.forEach(suggestion => {
                            const li = document.createElement('li');
                            li.innerHTML = suggestion;
                            li.onclick = () => {
                                input.value = suggestion;
                                suggestionsList.style.display = 'none';
                                document.getElementById('search-bar').focus();
                            };
                            suggestionsList.appendChild(li);
                        });

                        if (suggestions.length > 0) {
                            suggestionsList.style.display = 'block';
                        } else {
                            suggestionsList.style.display = 'none';
                        }
                    } else {
                        suggestionsList.style.display = 'none';
                    }
                }

                document.addEventListener("DOMContentLoaded", () => {
                    const searchBar = document.getElementById('search-bar');
                    searchBar.value = '';
                    searchBar.addEventListener('keypress', function(event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            const photo = searchBar.value;
                            if (trie.contains(photo)) {
                                const photo_path = "http://127.0.0.1:8080/images/" + photo + ".png";
                                window.location.href = photo_path;
                            }
                        }
                    })
                });
            </script>
        </head>
        <body>
            <h1 id="page-title">Gallery</h1>
            <div class="search-container">
                <input id="search-bar" type="text" class="search-bar" placeholder="Search..." oninput="showSuggestions()"/>
            </div>
            <div class="search-container">
                <ul class="suggestions-list"></ul>
            </div>
            <div id="gallery"></div>
            <script>getPhotos()</script>
        </body>
    </html>